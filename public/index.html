<!doctype html>
<html>
<head>
<title>VINDATA VIN Lookup</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: system-ui; max-width:700px; margin:40px auto; }
input,button { padding:12px; font-size:16px; width:100%; margin:8px 0; }
button { background:#0066ff; color:white; border:none; border-radius:8px; }
</style>
</head>

<body>
<h2>VINDATA.ca VIN Lookup</h2>

<input id="vin" placeholder="Enter VIN">
<input id="email" placeholder="Enter email">

<button onclick="lookup()">Check VIN</button>

<div id="result"></div>

<script>
async function lookup(){
  const vin = vin.value.trim();
  const email = document.getElementById("email").value.trim();

  const r = await fetch(`/api/lookup/${vin}`);
  const j = await r.json();

  if(j.success){
    result.innerHTML = `
      <p>Make: ${j.decode.make}</p>
      <p>Model: ${j.decode.model}</p>
      <p>Year : ${j.decode.year}</p>
      <button onclick="pay('${vin}','${email}')">Pay & Get Report</button>
    `;
  } else {
    result.innerText = "VIN lookup failed.";
  }
}

async function pay(vin,email){
  const r = await fetch("/api/create-checkout",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({vin,email})
  });

  const j = await r.json();
  if(j.url) window.location = j.url;
}
</script>

</body>
</html>
